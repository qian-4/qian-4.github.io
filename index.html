<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ダミー選挙投票フォーム（デモ）</title>
  <style>
    /*シンプルで読みやすいスタイル*/
    :root{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", sans-serif;
      background: #f4f7fb;
      color: #111;
    }
    .wrap{
      max-width: 760px;
      margin: 36px auto;
      padding: 24px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.08);
    }
    h1{margin:0 0 8px; font-size:1.4rem;}
    p.lead{margin:0 0 18px; color:#555;}
    fieldset{border:1px solid #e1e6ef; padding:16px; margin-bottom:16px; border-radius:8px;}
    legend{font-weight:600;}
    .candidates{display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:12px; margin-top:12px;}
    .candidate{
      border:1px solid #e7edf6; padding:10px; border-radius:8px;
      display:flex; gap:10px; align-items:center;
      background:#fbfdff;
    }
    .avatar{
      width:44px; height:44px; display:inline-grid; place-items:center; border-radius:50%;
      background:#eef6ff; font-weight:700; color:#036;
    }
    label{cursor:pointer; display:flex; gap:8px; align-items:center; width:100%;}
    input[type="radio"]{accent-color:#036; transform:scale(1.05);}
    .controls{display:flex; gap:8px; align-items:center; margin-top:12px;}
    button{padding:10px 14px; border-radius:8px; border:0; cursor:pointer; font-weight:600;}
    button.primary{background:#036;color:#fff;}
    button.ghost{background:transparent;border:1px solid #cdd9ea;}
    .note{font-size:0.9rem; color:#666; margin-top:12px;}
    .message{margin-top:12px; padding:10px; border-radius:8px;}
    .success{background:#e8f8ee; border:1px solid #c6efd8; color:#065;}
    .error{background:#fff1f0; border:1px solid #ffd0ce; color:#9a1d0f;}
    footer{font-size:0.8rem; color:#777; margin-top:14px;}
    .small{font-size:0.85rem;}
  </style>
</head>
<body>
  <main class="wrap" role="main">
    <h1>ダミー選挙投票フォーム（デモ）</h1>
    <p class="lead">本物の選挙には使わないでください。これはシミュレーション／UIデモです。</p>

    <form id="voteForm" autocomplete="off" novalidate>
      <fieldset>
        <legend>立候補者を選んでください</legend>
        <div class="candidates" role="radiogroup" aria-label="候補者一覧">
          <div class="candidate">
            <label>
              <input type="radio" name="candidate" value="A" aria-label="候補者A — 山田 太郎" />
              <span class="avatar" aria-hidden="true">A</span>
              <div>
                <div><strong>候補者 A</strong></div>
                <div class="small">政策ポイント：教育改革・地域活性化</div>
              </div>
            </label>
          </div>

          <div class="candidate">
            <label>
              <input type="radio" name="candidate" value="B" aria-label="候補者B — 佐藤 花子" />
              <span class="avatar" aria-hidden="true">B</span>
              <div>
                <div><strong>候補者 B</strong></div>
                <div class="small">政策ポイント：環境・福祉の強化</div>
              </div>
            </label>
          </div>

          <div class="candidate">
            <label>
              <input type="radio" name="candidate" value="C" aria-label="候補者C — 自由記入" />
              <span class="avatar" aria-hidden="true">C</span>
              <div>
                <div><strong>候補者 C</strong></div>
                <div class="small">政策ポイント：経済成長・雇用創出</div>
              </div>
            </label>
          </div>
        </div>

        <div style="margin-top:12px;">
          <label for="writeIn" class="small">上の候補者以外（記入可 / 任意）</label><br/>
          <input id="writeIn" name="writeIn" type="text" placeholder="候補者名（任意）" style="width:100%; padding:8px; margin-top:6px; border:1px solid #d7e0ef; border-radius:6px;" />
        </div>
      </fieldset>

      <fieldset>
        <legend>確認（ダミー）</legend>
        <label style="display:flex; gap:8px; align-items:center;">
          <input type="checkbox" id="confirmEligible" required />
          <span class="small">私はこのデモが練習用であることを理解しており、実際の選挙では適切な資格と手続きを行います。</span>
        </label>

        <div class="note small">このデモはローカル（ブラウザ）にだけ記録します。サーバへ送信は行いません。</div>
      </fieldset>

      <div class="controls">
        <button type="submit" class="primary" id="submitBtn">投票する</button>
        <button type="button" class="ghost" id="resetBtn">リセット（デモ用）</button>
        <div id="status" aria-live="polite" style="flex:1"></div>
      </div>

      <div id="resultArea" class="message" style="display:none;"></div>
      <footer>
        <div>デモモード：ブラウザの localStorage に「投票済み」フラグを保存します。別のブラウザやシークレットウィンドウでは再投票できます。</div>
      </footer>
    </form>
  </main>

  <script>
    // 簡単なクライアント側ロジック（本物の投票には絶対に使わないこと）
    (function(){
      const form = document.getElementById('voteForm');
      const status = document.getElementById('status');
      const resultArea = document.getElementById('resultArea');
      const submitBtn = document.getElementById('submitBtn');
      const resetBtn = document.getElementById('resetBtn');
      const STORAGE_KEY = 'dummy_election_vote_v1';

      function hasVoted(){
        return !!localStorage.getItem(STORAGE_KEY);
      }

      function showMessage(text, type){
        resultArea.style.display = 'block';
        resultArea.textContent = text;
        resultArea.className = 'message ' + (type === 'ok' ? 'success' : 'error');
      }

      function clearMessage(){
        resultArea.style.display = 'none';
        resultArea.textContent = '';
      }

      // 初期表示
      if (hasVoted()){
        showMessage('あなたはこのブラウザで既に投票済みです（デモ）。リセットボタンで状態を消せます。', 'ok');
      }

      form.addEventListener('submit', function(evt){
        evt.preventDefault();
        clearMessage();
        status.textContent = '';

        if (hasVoted()){
          showMessage('エラー: このブラウザでは既に投票済みです（デモ）。', 'error');
          return;
        }

        // 選択チェック
        const selected = form.querySelector('input[name="candidate"]:checked');
        const writeIn = document.getElementById('writeIn').value.trim();
        const confirmed = document.getElementById('confirmEligible').checked;

        if (!confirmed){
          showMessage('「確認」にチェックしてください。', 'error');
          return;
        }

        if (!selected && !writeIn){
          showMessage('候補者を選ぶか、記入欄に名前を入れてください。', 'error');
          return;
        }

        // 模擬送信処理
        submitBtn.disabled = true;
        submitBtn.textContent = '送信中…';
        status.textContent = '送信を処理しています（デモ）';

        setTimeout(() => {
          const voteRecord = {
            candidate: selected ? selected.value : null,
            writeIn: writeIn || null,
            timestamp: new Date().toISOString()
          };
          // ブラウザローカルに保存（デモ）
          try {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(voteRecord));
            showMessage('投票完了（デモ）。ありがとうございました。', 'ok');
            status.textContent = '';
          } catch (e){
            showMessage('保存に失敗しました（ブラウザが対応していない可能性があります）。', 'error');
          } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = '投票する';
          }
        }, 800); // UX用にちょっと待たせる
      });

      resetBtn.addEventListener('click', function(){
        if (confirm('デモ用の投票状態をリセットしますか？（本物の投票データはありません）')){
          localStorage.removeItem(STORAGE_KEY);
          clearMessage();
          status.textContent = 'リセットしました。';
        }
      });

      // キーボードアクセス補助（ラジオグループ向けの簡易フォーカス）
      const radios = Array.from(document.querySelectorAll('input[name="candidate"]'));
      radios.forEach(r => {
        r.addEventListener('keydown', e => {
          const idx = radios.indexOf(e.target);
          if (e.key === 'ArrowRight' || e.key === 'ArrowDown'){
            e.preventDefault();
            radios[(idx + 1) % radios.length].focus();
            radios[(idx + 1) % radios.length].checked = true;
          } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp'){
            e.preventDefault();
            radios[(idx - 1 + radios.length) % radios.length].focus();
            radios[(idx - 1 + radios.length) % radios.length].checked = true;
          }
        });
      });
    })();
  </script>
</body>
</html>
